import React, { createContext, useContext, useMemo } from 'react';
import { usePreferencesStore } from '../stores/preferences';

const translations = {
  en: {
    settings: 'Settings',
    profile: 'Profile',
    manage_account_and_prefs: 'Manage your account and preferences',
    quick_actions: 'Quick Actions',
    weekly_progress: 'Weekly Progress',
    youre_doing_great: "You're doing great this week!",
    today: 'Today',
    tasks_completed: 'Tasks Completed',
    focus_time: 'Focus Time',
    health_score: 'Health Score',
    day_streak: 'Day Streak',
    keep_it_up: 'Keep it up!',
    sign_out: 'Sign Out',
    signing_out: 'Signing Out...',
    about_version: 'TimeCraft Mobile v1.0.0',
    good_morning: 'Good morning',
    good_afternoon: 'Good afternoon',
    good_evening: 'Good evening',
    dashboard_refreshed: 'Dashboard refreshed',
    // Profile sections/items
    account: 'Account',
    edit_profile: 'Edit Profile',
    update_personal_info: 'Update your personal information',
    achievements: 'Achievements',
    view_badges_milestones: 'View your badges and milestones',
    analytics: 'Analytics',
    detailed_insights_reports: 'Detailed insights and reports',
    social: 'Social',
    feed_challenges_connections: 'Feed, challenges, and connections',
    support: 'Support',
    help_support: 'Help & Support',
    get_help_and_contact_support: 'Get help and contact support',
    student_account: 'Student Account',
    active_challenges: 'Active Challenges',
    leaderboard: 'Leaderboard',
    connections: 'Connections',
    sign_out_title: 'Sign Out',
    are_you_sure_sign_out: 'Are you sure you want to sign out?',
    unable_to_open_link: 'Unable to open link',
    // Auth/Login
    welcome_back: 'Welcome Back',
    sign_in_to_account: 'Sign in to your Ploracs account',
    continue_with_google: 'Continue with Google',
    or: 'or',
    continue_with_email: 'Continue with Email',
    continue_with_password_instead: 'Continue with password instead',
    email_address: 'Email Address',
    password: 'Password',
    hide: 'Hide',
    show: 'Show',
    forgot_password: 'Forgot password?',
    signing_in: 'Signing in...',
    sign_in: 'Sign In',
    dont_have_account: "Don't have an account?",
    sign_up: 'Sign up',
    with: 'with',
    // Health Connect / Apple Health
    health: 'Health',
    health_connect: 'Health Connect',
    connect_health_services: 'Connect Health Services',
    connect_health_desc_android: 'Connect to Health Connect to automatically log workouts, sleep, hydration, weight and more.',
    connect_health_desc_ios: 'Connect to Apple Health to automatically log workouts, sleep, hydration, weight and more.',
    connect_now: 'Connect Now',
    connected: 'Connected',
    not_connected: 'Not Connected',
    health_sync_enabled: 'Automatic health syncing is enabled',
    health_sync_unavailable: 'Health syncing is unavailable in this build',
    // OTP / Email login
    email_address_label: 'Email Address',
    enter_your_email: 'Enter your email',
    send_code: 'Send Code',
    sending: 'Sending...',
    back_to_other_options: 'Back to other options',
    paste_entire_code_hint: 'You can paste the entire code at once',
    code_expires_in: 'Code expires in',
    verifying: 'Verifying...',
    resend_code: 'Resend Code',
    change_email: 'Change Email',
    didnt_receive_code: "Didn't receive the code? Check your spam folder or try resending.",
    // Calendar Integrations
    calendar_integrations: 'Calendar Integrations',
    loading_integrations: 'Loading integrations...',
    connected_calendars: 'Connected Calendars',
    available_integrations: 'Available Integrations',
    auto_sync: 'Auto-sync',
    sync_now: 'Sync Now',
    syncing: 'Syncing...',
    connect: 'Connect',
    connecting: 'Connecting...',
    about_calendar_sync: 'About Calendar Sync',
    about_calendar_sync_desc: 'Connect your external calendars to automatically sync events. Your data stays secure and you can disconnect at any time.',
    last_sync: 'Last sync',
    disconnect_calendar: 'Disconnect Calendar',
    disconnect_calendar_confirm: 'Are you sure you want to disconnect {{name}}? This will stop syncing events from this calendar.',
    cancel: 'Cancel',
    disconnect: 'Disconnect',
    success: 'Success',
    error: 'Error',
    coming_soon: 'Coming Soon',
    google_calendar_integration: 'Google Calendar Integration',
    google_calendar_integration_desc: 'Google Calendar integration will be available soon. This feature requires additional setup for mobile authentication.',
    ok: 'OK',
    
    // Settings
    security: 'Security',
    notifications: 'Notifications',
    task_reminders: 'Task Reminders',
    get_notified_before_tasks: 'Get notified before tasks are due',
    health_reminders: 'Health Reminders',
    hydration_mood_exercise: 'Hydration, mood check-ins, exercise',
    focus_session_alerts: 'Focus Session Alerts',
    session_completion_break: 'Session completion and break reminders',
    achievements_label: 'Achievements',
    celebrate_milestones: 'Celebrate your milestones',
    weekly_reports: 'Weekly Reports',
    weekly_productivity_summaries: 'Weekly productivity summaries',
    app_preferences: 'App Preferences',
    theme: 'Theme',
    system_default: 'System default',
    light: 'Light',
    dark: 'Dark',
    language: 'Language',
    english: 'English',
    german: 'German',
    color_theme: 'Color Theme',
    blue: 'Blue',
    green: 'Green',
    purple: 'Purple',
    red: 'Red',
    close: 'Close',
    about: 'About',
    timecraft_mobile: 'TimeCraft Mobile',
    version_1_0_0: 'Version 1.0.0',
    export_data: 'Export Data',
    download_your_data: 'Download your data',
    delete_account: 'Delete Account',
    permanently_delete_account: 'Permanently delete your account',
    choose_theme: 'Choose theme',
    choose_language: 'Choose language',
    choose_color_theme: 'Choose color theme',
    biometric_login: '{{biometric}} Login',
    use_biometric_to_sign_in: 'Use {{biometric}} to quickly sign in to your account',
    not_supported_on_device: 'Not supported on this device',
    not_set_up_in_settings: '{{biometric}} not set up in device settings',
    not_available: 'Not available',
    setup_required: 'Setup Required',
    to_use_biometric_setup: 'To use {{biometric}}, please set it up in your device settings first.',
  },
  de: {
    settings: 'Einstellungen',
    profile: 'Profil',
    manage_account_and_prefs: 'Verwalte dein Konto und deine Einstellungen',
    quick_actions: 'Schnellaktionen',
    weekly_progress: 'Wöchentlicher Fortschritt',
    youre_doing_great: 'Diese Woche läuft es super!',
    today: 'Heute',
    tasks_completed: 'Aufgaben erledigt',
    focus_time: 'Fokuszeit',
    health_score: 'Gesundheitswert',
    day_streak: 'Tagesserie',
    keep_it_up: 'Weiter so!',
    sign_out: 'Abmelden',
    signing_out: 'Wird abgemeldet...',
    about_version: 'TimeCraft Mobile v1.0.0',
    good_morning: 'Guten Morgen',
    good_afternoon: 'Guten Tag',
    good_evening: 'Guten Abend',
    dashboard_refreshed: 'Dashboard aktualisiert',
    // Profile sections/items
    account: 'Konto',
    edit_profile: 'Profil bearbeiten',
    update_personal_info: 'Aktualisiere deine persönlichen Informationen',
    achievements: 'Erfolge',
    view_badges_milestones: 'Sieh dir Abzeichen und Meilensteine an',
    analytics: 'Analysen',
    detailed_insights_reports: 'Detaillierte Einblicke und Berichte',
    social: 'Soziales',
    feed_challenges_connections: 'Feed, Herausforderungen und Verbindungen',
    support: 'Support',
    help_support: 'Hilfe & Support',
    get_help_and_contact_support: 'Erhalte Hilfe und kontaktiere den Support',
    student_account: 'Studentenkonto',
    active_challenges: 'Aktive Herausforderungen',
    leaderboard: 'Bestenliste',
    connections: 'Verbindungen',
    sign_out_title: 'Abmelden',
    are_you_sure_sign_out: 'Möchtest du dich wirklich abmelden?',
    unable_to_open_link: 'Link kann nicht geöffnet werden',
    // Auth/Login
    welcome_back: 'Willkommen zurück',
    sign_in_to_account: 'Melde dich bei deinem Ploracs-Konto an',
    continue_with_google: 'Weiter mit Google',
    or: 'oder',
    continue_with_email: 'Weiter mit E-Mail',
    continue_with_password_instead: 'Stattdessen mit Passwort fortfahren',
    email_address: 'E-Mail-Adresse',
    password: 'Passwort',
    hide: 'Verbergen',
    show: 'Anzeigen',
    forgot_password: 'Passwort vergessen?',
    signing_in: 'Anmeldung läuft...',
    sign_in: 'Anmelden',
    dont_have_account: 'Noch kein Konto?',
    sign_up: 'Registrieren',
    with: 'mit',
    // Health Connect / Apple Health
    health: 'Gesundheit',
    health_connect: 'Health Connect',
    connect_health_services: 'Gesundheitsdienste verbinden',
    connect_health_desc_android: 'Verbinde Health Connect, um Trainings, Schlaf, Hydration, Gewicht und mehr automatisch zu protokollieren.',
    connect_health_desc_ios: 'Verbinde Apple Health, um Trainings, Schlaf, Hydration, Gewicht und mehr automatisch zu protokollieren.',
    connect_now: 'Jetzt verbinden',
    connected: 'Verbunden',
    not_connected: 'Nicht verbunden',
    health_sync_enabled: 'Automatische Gesundheitssynchronisierung ist aktiviert',
    health_sync_unavailable: 'Gesundheitssynchronisierung ist in diesem Build nicht verfügbar',
    // OTP / Email login
    email_address_label: 'E-Mail-Adresse',
    enter_your_email: 'Gib deine E-Mail ein',
    send_code: 'Code senden',
    sending: 'Senden...',
    back_to_other_options: 'Zurück zu anderen Optionen',
    paste_entire_code_hint: 'Du kannst den gesamten Code auf einmal einfügen',
    code_expires_in: 'Code läuft ab in',
    verifying: 'Überprüfung...',
    resend_code: 'Code erneut senden',
    change_email: 'E-Mail ändern',
    didnt_receive_code: 'Code nicht erhalten? Prüfe deinen Spam-Ordner oder sende erneut.',
    // Calendar Integrations
    calendar_integrations: 'Kalender-Integrationen',
    loading_integrations: 'Integrationen werden geladen...',
    connected_calendars: 'Verbundene Kalender',
    available_integrations: 'Verfügbare Integrationen',
    auto_sync: 'Auto-Sync',
    sync_now: 'Jetzt synchronisieren',
    syncing: 'Wird synchronisiert...',
    connect: 'Verbinden',
    connecting: 'Verbinden...',
    about_calendar_sync: 'Über die Kalendersynchronisierung',
    about_calendar_sync_desc: 'Verbinde externe Kalender, um Ereignisse automatisch zu synchronisieren. Deine Daten bleiben sicher und du kannst die Verbindung jederzeit trennen.',
    last_sync: 'Letzte Synchronisierung',
    disconnect_calendar: 'Kalender trennen',
    disconnect_calendar_confirm: 'Möchtest du {{name}} wirklich trennen? Dadurch wird die Synchronisierung von diesem Kalender gestoppt.',
    cancel: 'Abbrechen',
    disconnect: 'Trennen',
    success: 'Erfolg',
    error: 'Fehler',
    coming_soon: 'Demnächst verfügbar',
    google_calendar_integration: 'Google Kalender-Integration',
    google_calendar_integration_desc: 'Die Google Kalender-Integration ist bald verfügbar. Diese Funktion erfordert zusätzliche Einrichtung für die mobile Authentifizierung.',
    ok: 'OK',
    
    // Settings
    security: 'Sicherheit',
    notifications: 'Benachrichtigungen',
    task_reminders: 'Aufgabenerinnerungen',
    get_notified_before_tasks: 'Benachrichtigungen vor Fälligkeit',
    health_reminders: 'Gesundheitserinnerungen',
    hydration_mood_exercise: 'Hydration, Stimmungs-Check-ins, Training',
    focus_session_alerts: 'Fokus-Sitzungsbenachrichtigungen',
    session_completion_break: 'Sitzungsende und Pausenerinnerungen',
    achievements_label: 'Erfolge',
    celebrate_milestones: 'Feiere deine Meilensteine',
    weekly_reports: 'Wochenberichte',
    weekly_productivity_summaries: 'Wöchentliche Produktivitätsübersicht',
    app_preferences: 'App-Einstellungen',
    theme: 'Design',
    system_default: 'Systemstandard',
    light: 'Hell',
    dark: 'Dunkel',
    language: 'Sprache',
    english: 'Englisch',
    german: 'Deutsch',
    color_theme: 'Farbthema',
    blue: 'Blau',
    green: 'Grün',
    purple: 'Lila',
    red: 'Rot',
    close: 'Schließen',
    about: 'Info',
    timecraft_mobile: 'TimeCraft Mobile',
    version_1_0_0: 'Version 1.0.0',
    export_data: 'Daten exportieren',
    download_your_data: 'Lade deine Daten herunter',
    delete_account: 'Konto löschen',
    permanently_delete_account: 'Konto dauerhaft löschen',
    choose_theme: 'Design wählen',
    choose_language: 'Sprache wählen',
    choose_color_theme: 'Farbthema wählen',
    biometric_login: '{{biometric}} Anmeldung',
    use_biometric_to_sign_in: 'Verwende {{biometric}}, um dich schnell anzumelden',
    not_supported_on_device: 'Auf diesem Gerät nicht unterstützt',
    not_set_up_in_settings: '{{biometric}} nicht in den Geräteeinstellungen eingerichtet',
    not_available: 'Nicht verfügbar',
    setup_required: 'Einrichtung erforderlich',
    to_use_biometric_setup: 'Um {{biometric}} zu verwenden, richte es zuerst in den Geräteeinstellungen ein.',
  },
} as const;

type LangKey = keyof typeof translations;

type I18nContextType = {
  t: (key: keyof typeof translations['en']) => string;
  lang: LangKey;
};

const I18nContext = createContext<I18nContextType>({ t: (k) => String(k), lang: 'en' });

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const lang = usePreferencesStore((s) => s.language) as LangKey;
  const dict = translations[lang] ?? translations.en;

  const value = useMemo<I18nContextType>(() => ({
    t: (key) => dict[key] ?? String(key),
    lang,
  }), [dict, lang]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  return useContext(I18nContext);
}
